<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/common :: head('Quiz Game')}">
    <title>Quiz Game</title>
</head>
<body>

<link rel="stylesheet" th:href="@{/css/quiz.css}">

<div class="top-bar">
    <a href="/" class="text-decoration-none fw-bold" style="color: var(--text-muted)">âœ• Exit</a>
    <div class="d-flex align-items-center">
        <div class="timer-badge">â± <span id="timerDisplay">00:00</span></div>
        <div class="ms-3" id="streakBox" style="display: none; align-items: center; gap: 0.5rem;">
            <span style="font-size: 1.2rem;">ğŸ”¥</span>
            <span class="fw-bold" style="color: #F59E0B;" id="streakVal">0</span>
        </div>
    </div>
    <div class="d-flex align-items-center gap-3">
        <button class="control-btn" onclick="toggleSound()" id="soundBtn">ğŸ”Š</button>
        <button class="control-btn" onclick="toggleTheme()" id="themeBtn">ğŸŒ™</button>
        <div class="badge bg-primary rounded-pill px-3 py-2">ğŸ’ <span id="scoreVal">0</span></div>
    </div>
</div>

<div class="container" style="max-width: 800px; margin-top: 3rem;">
    <div id="gameArea">
        <div class="d-flex justify-content-between mb-3 px-1">
            <span class="badge" style="background: var(--btn-border); color: var(--text-muted);" th:text="${currentGroup}">SECTION</span>
            <span style="color: var(--text-muted); font-weight: 600;">
                <span id="currentNum">1</span> / <span id="totalNum">20</span>
            </span>
        </div>
        <div class="progress mb-4" style="height: 6px; background: var(--btn-border); border-radius: 3px;">
            <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%; border-radius: 3px; background: var(--accent-gradient);"></div>
        </div>
        <div class="question-card fade-enter">
            <h4 class="fw-bold m-0" style="line-height: 1.5;" id="questionText">Loading...</h4>
        </div>
        <div id="optionsArea" class="option-grid"></div>
        <div class="text-center mt-3 text-muted small opacity-50">Press 1-5 on keyboard</div>
    </div>

    <div id="inputNameArea" class="text-center fade-in" style="display: none; margin-top: 2rem;">
        <h2 class="fw-bold mb-2">Quiz Completed!</h2>
        <p class="fs-5 mb-4">Score: <span id="finalScore" class="fw-bold text-primary"></span></p>
        <div class="card p-4 border-0 shadow-lg rounded-4 mx-auto" style="max-width: 400px; background: var(--card-bg);">
            <input type="text" id="username" class="form-control mb-3" placeholder="Enter Name" maxlength="15">
            <button type="button" id="saveBtn" onclick="submitScore()" class="btn btn-primary w-100 py-2">Save Result</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script th:replace="~{fragments/common :: scripts}"></script>

<script th:inline="javascript">
    const QuizConfig = {
        questionsJson: [[${questionsJson}]],
        submitUrl: [[@{/api/submit-score}]],
    categoryId: [[${categoryId}]]
    };
</script>

<script th:src="@{/js/quiz-game.js}"></script>

</body>
</html>